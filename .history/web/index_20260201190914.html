<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Knowledge Hub â€” ECSS</title>
  <link rel="stylesheet" href="/web/styles.css">
</head>
<body>
  <main>
    <h1>Knowledge Hub</h1>
    <p>Centralize glossary, diagrams, equations, references, and method sheets.</p>

    <div class="search" style="margin:12px 0 18px 0">
      <input id="globalSearch" type="search" placeholder="Global search (glossary, diagrams, equations, references, methods)" style="flex:1;padding:10px 12px;border:1px solid rgba(255,255,255,0.08);border-radius:8px;font-size:15px;background:#061026;color:inherit" />
    </div>
    <div id="globalResults" style="margin-bottom:16px"></div>

    <nav class="mainMenu" role="navigation" aria-label="Main menu">
      <button id="menuGlossary">Glossary</button>
      <button id="menuDiagrams">Diagrams</button>
      <button id="menuEquations">Equations</button>
      <button id="menuReferences">References</button>
      <button id="menuMethods">Methods</button>
    </nav>

    <div id="glossaryApp" class="hidden" aria-hidden="true">
      <div class="search">
        <input id="q" type="search" placeholder="Search (term, definition, abbreviation)" autofocus />
        <div style="display:flex;gap:8px;align-items:center">
          <button id="viewDb" title="View full DB">View DB</button>
          <button id="showAdd">+ Add</button>
        </div>
      </div>

      <!-- Tag filter section -->
      <div id="tagFilterSection" style="margin:12px 0; padding:8px; border-radius:4px; background:rgba(77,161,255,0.1);">
        <div style="font-size:11px; font-weight:bold; margin-bottom:8px; color:var(--muted);">FILTER BY TAGS:</div>
        <div id="tagFilterContainer" style="display:flex;gap:8px;flex-wrap:wrap"></div>
        <button id="clearTagFilters" type="button" style="margin-top:8px;padding:4px 8px;font-size:12px;display:none">Clear All Tags</button>
      </div>

      <section id="editor" class="editor hidden" aria-hidden="true">
      <h2 id="editorTitle">Add a new entry</h2>
      <form id="addForm">
        <div class="row">
          <label>Term
            <input id="fieldTerm" required />
          </label>
        </div>
        <label>Abbreviation (optional)
          <input id="fieldAbbreviation" placeholder="e.g. BOE" />
        </label>
        <label>Definition / Signification
          <textarea id="fieldDefinition" rows="4" required></textarea>
        </label>
        <label>Tags (optional, comma-separated)
          <div style="position:relative">
            <input id="fieldTags" placeholder="e.g. cost-estimation, acronym, engineering" autocomplete="off" />
            <div id="tagSuggestions" class="tag-suggestions hidden"></div>
          </div>
        </label>
        <input type="hidden" id="fieldId" />
        <div class="formActions">
          <button id="saveBtn" type="submit">Save</button>
          <button id="cancelBtn" type="button">Cancel</button>
        </div>
      </form>
    </section>

      <div id="results"></div>
    </div>

    <!-- Diagrams app view (inline, not modal) -->
    <section id="diagramsApp" class="hidden" aria-hidden="true">
      <h2>Diagrams</h2>
      <p>Upload and browse your schematics and diagrams.</p>
      <!-- Tag filter for diagrams -->
      <div id="diagTagFilterSection" style="margin:12px 0; padding:8px; border-radius:4px; background:rgba(77,161,255,0.1);">
        <div style="font-size:11px; font-weight:bold; margin-bottom:8px; color:var(--muted);">FILTER BY TAGS:</div>
        <div id="diagTagFilterContainer" style="display:flex;gap:8px;flex-wrap:wrap"></div>
        <button id="clearDiagTagFilters" type="button" style="margin-top:8px;padding:4px 8px;font-size:12px;display:none">Clear All Tags</button>
      </div>
      <form id="uploadFormInline" style="display:flex;gap:8px;align-items:center;margin-bottom:12px">
        <input id="imgTitleInline" placeholder="Title for diagram" style="flex:1;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit" />
        <div style="position:relative;flex:1">
          <input id="imgTagsInline" placeholder="Tags (comma-separated)" style="width:100%;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit" autocomplete="off" />
          <div id="imgTagsInlineSuggestions" class="tag-suggestions hidden"></div>
        </div>
        <input id="imgFileInline" type="file" accept="image/*,.pdf" />
        <button id="uploadBtnInline" type="button">Upload</button>
      </form>
      <div id="diagramsGallery" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:12px"></div>
    </section>

    <!-- Equations app view -->
    <section id="equationsApp" class="hidden" aria-hidden="true">
      <h2>Equations</h2>
      <p>Store and search equations from your work.</p>
      <!-- Tag filter for equations -->
      <div id="eqTagFilterSection" style="margin:12px 0; padding:8px; border-radius:4px; background:rgba(77,161,255,0.1);">
        <div style="font-size:11px; font-weight:bold; margin-bottom:8px; color:var(--muted);">FILTER BY TAGS:</div>
        <div id="eqTagFilterContainer" style="display:flex;gap:8px;flex-wrap:wrap"></div>
        <button id="clearEqTagFilters" type="button" style="margin-top:8px;padding:4px 8px;font-size:12px;display:none">Clear All Tags</button>
      </div>
      <div class="search" style="margin-bottom:16px">
        <input id="eqSearch" type="search" placeholder="Search equations by name or content" style="flex:1;padding:10px 12px;border:1px solid rgba(255,255,255,0.08);border-radius:8px;font-size:15px;background:#061026;color:inherit" />
        <button id="eqShowAdd" style="padding:9px 12px;border-radius:8px;border:none;background:var(--accent);color:#071224;font-weight:700;cursor:pointer">+ Add Equation</button>
      </div>

      <section id="equationEditor" class="editor hidden" aria-hidden="true">
        <h3 id="eqEditorTitle">Add a new equation</h3>
        <form id="eqForm">
          <label>Equation Name/Label
            <input id="eqName" required style="width:100%;padding:10px;border:1px solid rgba(255,255,255,0.06);border-radius:8px;background:#061026;color:inherit" />
          </label>
          <label>Equation / Formula (LaTeX or text)
            <textarea id="eqContent" rows="4" required style="width:100%;padding:10px;border:1px solid rgba(255,255,255,0.06);border-radius:8px;background:#061026;color:inherit;font-family:monospace"></textarea>
          </label>
          <label>Description (optional)
            <textarea id="eqDescription" rows="2" style="width:100%;padding:10px;border:1px solid rgba(255,255,255,0.06);border-radius:8px;background:#061026;color:inherit"></textarea>
          </label>
          <label>Tags (optional, comma-separated)
            <div style="position:relative">
              <input id="eqTags" placeholder="e.g. physics, cost-estimation" autocomplete="off" style="width:100%;padding:10px;border:1px solid rgba(255,255,255,0.06);border-radius:8px;background:#061026;color:inherit" />
              <div id="eqTagsSuggestions" class="tag-suggestions hidden"></div>
            </div>
          </label>
          <input type="hidden" id="eqId" />
          <div class="formActions" style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
            <button id="eqSaveBtn" type="submit" style="padding:8px 12px;border-radius:8px;border:none;background:var(--accent);color:#071224;font-weight:700;cursor:pointer">Save</button>
            <button id="eqCancelBtn" type="button" style="padding:8px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:#061026;color:inherit;cursor:pointer">Cancel</button>
          </div>
        </form>
      </section>

      <div id="equationsList"></div>
    </section>

    <!-- References app view -->
    <section id="referencesApp" class="hidden" aria-hidden="true">
      <h2>References</h2>
      <p>Store and organize your references (books, articles, films, websites).</p>
      <!-- Tag filter for references -->
      <div id="refTagFilterSection" style="margin:12px 0; padding:8px; border-radius:4px; background:rgba(77,161,255,0.1);">
        <div style="font-size:11px; font-weight:bold; margin-bottom:8px; color:var(--muted);">FILTER BY TAGS:</div>
        <div id="refTagFilterContainer" style="display:flex;gap:8px;flex-wrap:wrap"></div>
        <button id="clearRefTagFilters" type="button" style="margin-top:8px;padding:4px 8px;font-size:12px;display:none">Clear All Tags</button>
      </div>
      <div class="search" style="margin-bottom:16px">
        <input id="refSearch" type="search" placeholder="Search references by title, author or content" style="flex:1;padding:10px 12px;border:1px solid rgba(255,255,255,0.08);border-radius:8px;font-size:15px;background:#061026;color:inherit" />
        <button id="refShowAdd" style="padding:9px 12px;border-radius:8px;border:none;background:var(--accent);color:#071224;font-weight:700;cursor:pointer">+ Add Reference</button>
      </div>

      <section id="referenceEditor" class="editor hidden" aria-hidden="true">
        <h3 id="refEditorTitle">Add a new reference</h3>
        <form id="refForm">
          <label>Title
            <input id="refTitle" required style="width:100%;padding:10px;border:1px solid rgba(255,255,255,0.06);border-radius:8px;background:#061026;color:inherit" />
          </label>
          <label>Author / Creator
            <input id="refAuthor" required style="width:100%;padding:10px;border:1px solid rgba(255,255,255,0.06);border-radius:8px;background:#061026;color:inherit" />
          </label>
          <label>Type
            <select id="refType" required style="width:100%;padding:10px;border:1px solid rgba(255,255,255,0.06);border-radius:8px;background:#061026;color:inherit">
              <option value="book">Book</option>
              <option value="article">Article</option>
              <option value="film">Film</option>
              <option value="website">Website</option>
              <option value="software">Software</option>
            </select>
          </label>
          <label>Description (optional)
            <textarea id="refDescription" rows="3" style="width:100%;padding:10px;border:1px solid rgba(255,255,255,0.06);border-radius:8px;background:#061026;color:inherit"></textarea>
          </label>
          <label>URL / Link (optional)
            <input id="refUrl" type="url" style="width:100%;padding:10px;border:1px solid rgba(255,255,255,0.06);border-radius:8px;background:#061026;color:inherit" />
          </label>
          <label>Tags (optional, comma-separated)
            <div style="position:relative">
              <input id="refTags" placeholder="e.g. physics, cost-estimation" autocomplete="off" style="width:100%;padding:10px;border:1px solid rgba(255,255,255,0.06);border-radius:8px;background:#061026;color:inherit" />
              <div id="refTagsSuggestions" class="tag-suggestions hidden"></div>
            </div>
          </label>
          <input type="hidden" id="refId" />
          <div class="formActions" style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
            <button id="refSaveBtn" type="submit" style="padding:8px 12px;border-radius:8px;border:none;background:var(--accent);color:#071224;font-weight:700;cursor:pointer">Save</button>
            <button id="refCancelBtn" type="button" style="padding:8px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:#061026;color:inherit;cursor:pointer">Cancel</button>
          </div>
        </form>
      </section>

      <div id="referencesList"></div>
    </section>

    <!-- Methods app view -->
    <section id="methodsApp" class="hidden" aria-hidden="true">
      <h2>Method Sheets</h2>
      <p>Store step-by-step method sheets with key components and critical success factors.</p>
      <div class="search" style="margin-bottom:16px">
        <input id="methodSearch" type="search" placeholder="Search method sheets by title or definition" style="flex:1;padding:10px 12px;border:1px solid rgba(255,255,255,0.08);border-radius:8px;font-size:15px;background:#061026;color:inherit" />
        <button id="methodShowAdd" style="padding:9px 12px;border-radius:8px;border:none;background:var(--accent);color:#071224;font-weight:700;cursor:pointer">+ Add Method</button>
      </div>

      <section id="methodEditor" class="editor hidden" aria-hidden="true">
        <h3 id="methodEditorTitle">Add a new method</h3>
        <form id="methodForm">
          <label>Title
            <input id="methodTitle" required style="width:100%;padding:10px;border:1px solid rgba(255,255,255,0.06);border-radius:8px;background:#061026;color:inherit" />
          </label>
          <label>Definition
            <textarea id="methodDefinition" rows="3" required style="width:100%;padding:10px;border:1px solid rgba(255,255,255,0.06);border-radius:8px;background:#061026;color:inherit"></textarea>
          </label>
          <label>Key Components (one per line)
            <textarea id="methodKeyComponents" rows="4" placeholder="- Component A\n- Component B" style="width:100%;padding:10px;border:1px solid rgba(255,255,255,0.06);border-radius:8px;background:#061026;color:inherit"></textarea>
          </label>
          <label>Procedure & Checklist (one per line)
            <textarea id="methodProcedure" rows="4" placeholder="- Step 1\n- Step 2" style="width:100%;padding:10px;border:1px solid rgba(255,255,255,0.06);border-radius:8px;background:#061026;color:inherit"></textarea>
          </label>
          <label>Critical Success Factors (one per line)
            <textarea id="methodSuccessFactors" rows="4" placeholder="- Factor A\n- Factor B" style="width:100%;padding:10px;border:1px solid rgba(255,255,255,0.06);border-radius:8px;background:#061026;color:inherit"></textarea>
          </label>
          <input type="hidden" id="methodId" />
          <div class="formActions" style="display:flex;gap:8px;justify-content:flex-end;margin-top:12px">
            <button id="methodSaveBtn" type="submit" style="padding:8px 12px;border-radius:8px;border:none;background:var(--accent);color:#071224;font-weight:700;cursor:pointer">Save</button>
            <button id="methodCancelBtn" type="button" style="padding:8px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:#061026;color:inherit;cursor:pointer">Cancel</button>
          </div>
        </form>
      </section>

      <div id="methodsList"></div>
    </section>
  </main>

  <!-- Modal for item detail -->
  <div id="modal" class="modal hidden" aria-hidden="true">
    <div class="modal__overlay" id="modalOverlay"></div>
    <div class="modal__panel" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
      <header class="modal__header">
        <h2 id="modalTitle">Title</h2>
        <div class="modal__meta" id="modalMeta"></div>
      </header>
      <div class="modal__body" id="modalBody"></div>
      <footer class="modal__footer">
        <button id="copyBtn">Copy definition</button>
        <button id="closeBtn">Close</button>
      </footer>
    </div>
  </div>

  <!-- Modal for DB viewer -->
  <div id="dbModal" class="modal hidden" aria-hidden="true">
    <div class="modal__overlay" id="dbModalOverlay"></div>
    <div class="modal__panel" role="dialog" aria-modal="true" aria-labelledby="dbModalTitle">
      <header class="modal__header">
        <h2 id="dbModalTitle">Glossary Database</h2>
        <div class="modal__meta" id="dbModalMeta"></div>
      </header>
      <div class="modal__body" id="dbModalBody">
        <div class="dbControls" style="display:flex;gap:8px;align-items:center;margin-bottom:10px;flex-wrap:wrap">
          <input id="dbSearch" placeholder="Filter term or definition" style="flex:1;min-width:200px;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit" />
          <label style="white-space:nowrap;color:var(--muted)">Sort:
            <select id="dbSort" style="margin-left:6px;padding:6px;border-radius:6px;background:transparent;color:inherit;border:1px solid rgba(255,255,255,0.04)">
              <option value="recent">Most Recent</option>
              <option value="oldest">Oldest First</option>
              <option value="alpha-asc">A-Z (Term)</option>
              <option value="alpha-desc">Z-A (Term)</option>
            </select>
          </label>
          <label style="white-space:nowrap;color:var(--muted)">Rows:
            <select id="dbRows" style="margin-left:6px;padding:6px;border-radius:6px;background:transparent;color:inherit;border:1px solid rgba(255,255,255,0.04)">
              <option value="5">5</option>
              <option value="10" selected>10</option>
              <option value="25">25</option>
            </select>
          </label>
        </div>
        <div id="dbTableContainer" style="max-height:60vh;overflow:auto"></div>
      </div>
      <footer class="modal__footer">
        <button id="downloadDb">Download JSON</button>
        <button id="closeDb">Close</button>
      </footer>
    </div>
  </div>

  <!-- Modal for Diagrams (upload and gallery) -->
  <div id="diagModal" class="modal hidden" aria-hidden="true">
    <div class="modal__overlay" id="diagModalOverlay"></div>
    <div class="modal__panel" role="dialog" aria-modal="true" aria-labelledby="diagModalTitle">
      <header class="modal__header">
        <h2 id="diagModalTitle">Diagrams</h2>
        <div class="modal__meta" id="diagModalMeta"></div>
      </header>
      <div class="modal__body" id="diagModalBody">
        <form id="uploadForm" style="display:flex;gap:8px;align-items:center;margin-bottom:12px">
          <input id="imgTitle" placeholder="Title for diagram" style="flex:1;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit" />
          <div style="position:relative;flex:1">
            <input id="imgTags" placeholder="Tags (comma-separated)" style="width:100%;padding:8px;border-radius:6px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit" autocomplete="off" />
            <div id="imgTagsSuggestions" class="tag-suggestions hidden"></div>
          </div>
          <input id="imgFile" type="file" accept="image/*,.pdf" />
          <button id="uploadBtn" type="button">Upload</button>
        </form>
        <div id="gallery" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:12px"></div>
      </div>
      <footer class="modal__footer">
        <button id="closeDiag">Close</button>
      </footer>
    </div>
  </div>

  <!-- KaTeX for LaTeX math rendering -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css" integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV" crossorigin="anonymous">
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js" integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8" crossorigin="anonymous"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js" integrity="sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05" crossorigin="anonymous"></script>
  <!-- Fuse.js for fuzzy search (client-side) -->
  <script src="https://cdn.jsdelivr.net/npm/fuse.js@6.6.2/dist/fuse.min.js"></script>
  <script src="/web/app.js"></script>
</body>
</html>

